<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Meteor Rain Predictor</title>

  <!-- CSS -->
  <link rel="stylesheet" href="style.css" />

  <!-- مكتبة الخريطة Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #006280; 
      color: #ffffff;
    }
    #map { height: 400px; margin-bottom: 20px; }
    .delete-btn { cursor: pointer; background: none; border: none; font-size: 1.2em; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #aaa; padding: 8px; text-align: center; }
    nav {
      background: #a6c8e0;
      padding: 10px;
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    nav ul { display: flex; list-style: none; padding: 0; margin: 0; }
    nav ul li { margin-right: 15px; }
    nav ul li a { text-decoration: none; color: #1a1a1a; font-weight: 500; }
    header, section, footer { padding: 20px; }
    .cards { display: flex; gap: 15px; flex-wrap: wrap; }
    .card {
      background: #ffffff;
      padding: 15px;
      border-radius: 8px;
      flex: 1;
      min-width: 150px;
      text-align: center;
      box-shadow: 0 3px 6px rgba(0,0,0,0.12);
    }
    .team-grid { display: flex; flex-wrap: wrap; gap: 15px; }
    .member { flex: 1 1 150px; text-align: center; }
    .dark { background: #222; color: #eee; }
    .dark nav { background: #333; }
    .dark nav ul li a { color: #eee; }
    .dark .card { background: #444; color: #eee; }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav>
    <ul>
      <li><a href="#home">🏠 Home</a></li>
      <li><a href="#map-section">🗺️ Map</a></li>
      <li><a href="#about">ℹ️ About</a></li>
      <li><a href="#features">✨ Features</a></li>
      <li><a href="#team">👨‍🚀 Team</a></li>
      <li><a href="#faq">❓ FAQ</a></li>
      <li><a href="#contact">📩 Contact</a></li>
    </ul>
    <button id="mode-toggle">🌙 Toggle Mode</button>
    <button id="clear-all" style="margin-left: 10px; background:#f44336; color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer;">🗑️ Clear All</button>
  </nav>

  <!-- Header -->
  <header id="home">
    <h1>☔ Will It Rain On My Parade?</h1>
    <p>Click anywhere on the map to check the rain probability</p>
  </header>

  <!-- Map Section -->
  <main id="map-section">
    <h2>Interactive Map</h2>
    <div id="map"></div>
    <div id="result"></div>
    <section id="history">
      <h3>📊 Prediction History</h3>
      <table id="history-table">
        <thead>
          <tr>
            <th>Lat</th>
            <th>Lon</th>
            <th>Rain %</th>
            <th>Time</th>
            <th>Remove</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
  </main>

  <!-- About Section -->
  <section id="about">
    <h2>About the Project</h2>
    <p>This project was developed for the NASA Space Apps Challenge 2025 🚀. Our mission is to help people predict rain probabilities in any location using satellite data and AI.</p>
    <div class="cards">
      <div class="card"><h3>🌍 Global Coverage</h3><p>Get predictions anywhere in the world.</p></div>
      <div class="card"><h3>🤖 AI Powered</h3><p>Machine learning estimates the chance of rainfall.</p></div>
      <div class="card"><h3>📱 Easy Access</h3><p>Mobile friendly, fast, and lightweight design.</p></div>
    </div>
  </section>

  <!-- Features Section -->
  <section id="features">
    <h2>✨ Features</h2>
    <ul>
      <li>Interactive map with markers</li>
      <li>Prediction history stored locally</li>
      <li>Dark/Light map modes</li>
      <li>Responsive mobile design</li>
      <li>Easy navigation with smooth scroll</li>
      <li>Custom notifications and alerts</li>
      <li>Team showcase section</li>
    </ul>
  </section>

  <!-- Team Section -->
  <section id="team">
    <h2>👨‍🚀 Meet the Team</h2>
    <div class="team-grid">
      <div class="member"><img src="https://via.placeholder.com/100" alt="member1" /><h4>محمد مصطفى</h4><p>Frontend Developer</p></div>
      <div class="member"><img src="https://via.placeholder.com/100" alt="member2" /><h4>سيف الدين</h4><p>Backend Developer</p></div>
      <div class="member"><img src="https://via.placeholder.com/100" alt="member3" /><h4>أحمد ثروت</h4><p>Data Scientist</p></div>
      <div class="member"><img src="https://via.placeholder.com/100" alt="member4" /><h4>عز الدين كريم</h4><p>AI Engineer</p></div>
      <div class="member"><img src="https://via.placeholder.com/100" alt="member5" /><h4>محمد أسامة</h4><p>Project Manager</p></div>
      <div class="member"><img src="https://via.placeholder.com/100" alt="member6" /><h4>أمل</h4><p>Designer</p></div>
    </div>
  </section>

  <!-- FAQ Section -->
  <section id="faq">
    <h2>❓ Frequently Asked Questions</h2>
    <details><summary>How does the prediction work?</summary><p>We use AI models trained on weather and satellite data.</p></details>
    <details><summary>Is it 100% accurate?</summary><p>No model is perfect, but we aim for high reliability.</p></details>
    <details><summary>Can I use this offline?</summary><p>Currently, you need internet access to fetch predictions.</p></details>
    <details><summary>Can I contribute to the project?</summary><p>Yes! Our project is open-source and welcomes contributors.</p></details>
  </section>

  <!-- Contact Section -->
  <section id="contact">
    <h2>📩 Contact Us</h2>
    <form>
      <input type="text" placeholder="Your Name" required />
      <input type="email" placeholder="Your Email" required />
      <textarea placeholder="Your Message"></textarea>
      <button type="submit">Send</button>
    </form>
  </section>

  <!-- Extra Info -->
  <section id="extra-info">
    <h2>🌟 Extra Information</h2>
    <p>Explore more about meteor showers, rain probabilities, and space weather data from NASA and other organizations.</p>
  </section>

  <!-- Footer -->
  <footer>
    <p>Powered by NASA Space Apps 🚀 | Built with ❤️</p>
    <p>© 2025 Meteor Rain Predictor</p>
  </footer>

  <script>
    const map = L.map("map").setView([30.0444, 31.2357], 5);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a>'
    }).addTo(map);

    const markers = new Map();

    function getRainProbability() { return Math.floor(Math.random()*101); }
    function getCurrentTime() { return new Date().toLocaleTimeString(); }
    function generateId() { return Date.now() + Math.random().toString(16).slice(2); }

    function saveToLocalStorage(id, lat, lon, rainProb, time) {
      let history = JSON.parse(localStorage.getItem("history")) || [];
      history.push({ id, lat, lon, rainProb, time });
      localStorage.setItem("history", JSON.stringify(history));
    }
    function removeFromLocalStorage(id) {
      let history = JSON.parse(localStorage.getItem("history")) || [];
      history = history.filter(item => item.id !== id);
      localStorage.setItem("history", JSON.stringify(history));
    }

    function addHistoryRow(id, lat, lon, rainProb, time) {
      const tbody = document.querySelector("#history-table tbody");
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${lat}</td>
        <td>${lon}</td>
        <td>${rainProb}%</td>
        <td>${time}</td>
        <td><button class="delete-btn">✖️</button></td>
      `;
      tbody.appendChild(row);

      const marker = L.marker([lat, lon]).addTo(map).bindPopup(`Rain: ${rainProb}%<br>(${lat}, ${lon})`);
      markers.set(id, marker);

      row.querySelector(".delete-btn").addEventListener("click", () => {
        row.remove();
        map.removeLayer(marker);
        markers.delete(id);
        removeFromLocalStorage(id);
      });
    }

    function loadHistory() {
      const history = JSON.parse(localStorage.getItem("history")) || [];
      history.forEach(item => addHistoryRow(item.id, item.lat, item.lon, item.rainProb, item.time));
    }

    function showNotification(title, body) {
      if (Notification.permission === "granted") {
        new Notification(title, { body });
      } else if (Notification.permission !== "denied") {
        Notification.requestPermission().then(permission => {
          if (permission === "granted") {
            new Notification(title, { body });
          }
        });
      }
    }

    map.on("click", e => {
      const lat = e.latlng.lat.toFixed(2);
      const lon = e.latlng.lng.toFixed(2);
      const rainProb = getRainProbability();
      const time = getCurrentTime();
      const id = generateId();
      addHistoryRow(id, lat, lon, rainProb, time);
      saveToLocalStorage(id, lat, lon, rainProb, time);
      document.getElementById("result").innerHTML = `
        <h3>📍 Location: (${lat}, ${lon})</h3>
        <p>🌧️ Rain Probability: <strong>${rainProb}%</strong></p>
        <p>🕒 Time: ${time}</p>
      `;
      // إشعار
      showNotification("🌧️ New Prediction", `(${lat}, ${lon}) → Rain: ${rainProb}% at ${time}`);
    });

    loadHistory();

    document.getElementById("mode-toggle").addEventListener("click", () => {
      document.body.classList.toggle("dark");
    });

    document.getElementById("clear-all").addEventListener("click", () => {
      document.querySelector("#history-table tbody").innerHTML = "";
      markers.forEach(marker => map.removeLayer(marker));
      markers.clear();
      localStorage.removeItem("history");
      alert("✅ All history and markers have been cleared!");
    });

    // My Location button
    const locateBtn = L.control({ position: "topright" });
    locateBtn.onAdd = function () {
      const btn = L.DomUtil.create("button", "locate-btn");
      btn.innerHTML = "📍 My Location";
      btn.style.padding = "5px";
      btn.style.background = "white";
      btn.style.cursor = "pointer";
      btn.onclick = function () {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition((pos) => {
            const lat = pos.coords.latitude;
            const lon = pos.coords.longitude;
            map.setView([lat, lon], 12);
            L.marker([lat, lon]).addTo(map).bindPopup("📍 You are here").openPopup();
          });
        }
      };
      return btn;
    };
    locateBtn.addTo(map);
  </script>
</body>
</html>
